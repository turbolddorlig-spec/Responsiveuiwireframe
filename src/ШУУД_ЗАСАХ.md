# üö® –ù–≠–í–¢–†–≠–• –ë–û–õ–û–ú–ñ–ì“Æ–ô –ê–°–£–£–î–ê–õ - –®–£–£–î –ó–ê–°–ê–•

## ‚ö° –ß–£–•–ê–õ: "Failed to fetch" –∞–ª–¥–∞–∞–Ω—ã —à–∞–ª—Ç–≥–∞–∞–Ω

–¢–∞ "Error initializing data: Failed to fetch" –≥—ç—Å—ç–Ω –∞–ª–¥–∞–∞ —Ö–∞—Ä–∂ –±–∞–π–Ω–∞. –≠–Ω—ç –Ω—å:

1. **Supabase database tables “Ø“Ø—Å–≥—ç—ç–≥“Ø–π –±–∞–π–Ω–∞** (90% –º–∞–≥–∞–¥–ª–∞–ª)
2. –≠–°–í–≠–õ Supabase Project –∞—Å–∞–∞–≥“Ø–π –±–∞–π–Ω–∞
3. –≠–°–í–≠–õ Network —Ö–æ–ª–±–æ–ª—Ç –∞–ª–¥–∞–∞—Ç–∞–π

## –¢–∞ –æ–¥–æ–æ —Ö–∏–π—Ö —ë—Å—Ç–æ–π:

### ‚úÖ –ê–õ–•–ê–ú 1: Supabase SQL Setup

1. **Supabase Dashboard –Ω—ç—ç—Ö:**
   ```
   https://supabase.com/dashboard
   ```

2. **SQL Editor —Ä—É—É –æ—á–∏—Ö:**
   - Dashboard ‚Üí SQL Editor (–∑“Ø“Ø–Ω —Ü—ç—Å)
   - "New query" —Ç–æ–≤—á –¥–∞—Ä–∞—Ö

3. **–î–æ–æ—Ä—Ö SQL –∫–æ–¥—ã–≥ —Ö—É—É–ª–∂ paste —Ö–∏–π—Ö:**

```sql
-- ============================================================================
-- COMPLETE SUPABASE SETUP FOR LOGISTICS SYSTEM
-- ============================================================================

-- Enable necessary extensions
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pgcrypto";

-- User Profiles Table
CREATE TABLE IF NOT EXISTS user_profiles (
    id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
    phone TEXT UNIQUE NOT NULL,
    name TEXT NOT NULL,
    role TEXT NOT NULL CHECK (role IN ('super_admin', 'admin', 'operator', 'driver', 'driver_lead', 'accounting', 'warehouse')),
    driver_name TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Products Table
CREATE TABLE IF NOT EXISTS products (
    id SERIAL PRIMARY KEY,
    code TEXT UNIQUE NOT NULL,
    name TEXT NOT NULL,
    size TEXT,
    color TEXT,
    price NUMERIC(12, 0) NOT NULL DEFAULT 0,
    description TEXT,
    image_url TEXT,
    stock INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Orders Table
CREATE TABLE IF NOT EXISTS orders (
    id SERIAL PRIMARY KEY,
    code TEXT UNIQUE NOT NULL,
    customer_phone TEXT,
    total_price NUMERIC(12, 0) DEFAULT 0,
    status TEXT DEFAULT 'NEW' CHECK (status IN ('NEW', 'IN_TRANSIT', 'DELIVERED', 'CANCELLED')),
    payment_status TEXT DEFAULT 'UNPAID' CHECK (payment_status IN ('PAID', 'UNPAID', 'PARTIAL')),
    payment_method TEXT CHECK (payment_method IN ('CASH', 'CARD', 'TRANSFER', 'QPAY')),
    delivery_date TEXT,
    delivery_time TEXT,
    address TEXT,
    district TEXT,
    khoroo TEXT,
    driver_id UUID REFERENCES user_profiles(id),
    notes TEXT,
    products JSONB DEFAULT '[]'::JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Driver Leads Table
CREATE TABLE IF NOT EXISTS driver_leads (
    id SERIAL PRIMARY KEY,
    name TEXT,
    phone TEXT NOT NULL,
    district TEXT,
    province TEXT,
    note TEXT,
    status TEXT DEFAULT 'OPEN' CHECK (status IN ('OPEN', 'CONTACTED', 'CLOSED')),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Stocks Table
CREATE TABLE IF NOT EXISTS stocks (
    id SERIAL PRIMARY KEY,
    product_code TEXT NOT NULL,
    qty INTEGER NOT NULL DEFAULT 0,
    warehouse TEXT NOT NULL,
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    CONSTRAINT positive_qty CHECK (qty >= 0)
);

-- Create indexes
CREATE INDEX IF NOT EXISTS idx_user_profiles_phone ON user_profiles(phone);
CREATE INDEX IF NOT EXISTS idx_products_code ON products(code);
CREATE INDEX IF NOT EXISTS idx_orders_code ON orders(code);
CREATE INDEX IF NOT EXISTS idx_orders_status ON orders(status);
CREATE INDEX IF NOT EXISTS idx_stocks_product_code ON stocks(product_code);

-- Updated at trigger
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_user_profiles_updated_at BEFORE UPDATE ON user_profiles FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
CREATE TRIGGER update_products_updated_at BEFORE UPDATE ON products FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
CREATE TRIGGER update_orders_updated_at BEFORE UPDATE ON orders FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
CREATE TRIGGER update_stocks_updated_at BEFORE UPDATE ON stocks FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- Enable RLS
ALTER TABLE user_profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE products ENABLE ROW LEVEL SECURITY;
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;
ALTER TABLE driver_leads ENABLE ROW LEVEL SECURITY;
ALTER TABLE stocks ENABLE ROW LEVEL SECURITY;

-- RLS Policies for user_profiles
CREATE POLICY "Allow authenticated users to view profiles" ON user_profiles FOR SELECT TO authenticated USING (true);
CREATE POLICY "Allow users to update own profile" ON user_profiles FOR UPDATE TO authenticated USING (auth.uid() = id);

-- RLS Policies for products
CREATE POLICY "Allow all authenticated users to view products" ON products FOR SELECT TO authenticated USING (true);
CREATE POLICY "Allow admins to manage products" ON products FOR ALL TO authenticated 
USING (
    EXISTS (
        SELECT 1 FROM user_profiles 
        WHERE id = auth.uid() AND role IN ('super_admin', 'admin', 'warehouse')
    )
);

-- RLS Policies for orders
CREATE POLICY "Allow authenticated users to view orders" ON orders FOR SELECT TO authenticated USING (
    EXISTS (
        SELECT 1 FROM user_profiles 
        WHERE id = auth.uid() 
        AND (
            role IN ('super_admin', 'admin', 'operator', 'driver_lead', 'accounting')
            OR (role = 'driver' AND driver_id = auth.uid())
        )
    )
);

CREATE POLICY "Allow admins and operators to manage orders" ON orders FOR ALL TO authenticated 
USING (
    EXISTS (
        SELECT 1 FROM user_profiles 
        WHERE id = auth.uid() AND role IN ('super_admin', 'admin', 'operator')
    )
);

-- RLS Policies for stocks
CREATE POLICY "Allow authenticated users to view stocks" ON stocks FOR SELECT TO authenticated USING (true);
CREATE POLICY "Allow warehouse to manage stocks" ON stocks FOR ALL TO authenticated 
USING (
    EXISTS (
        SELECT 1 FROM user_profiles 
        WHERE id = auth.uid() AND role IN ('super_admin', 'admin', 'warehouse')
    )
);

-- RLS Policies for driver_leads
CREATE POLICY "Allow authenticated users to view driver leads" ON driver_leads FOR SELECT TO authenticated USING (true);
CREATE POLICY "Allow admins to manage driver leads" ON driver_leads FOR ALL TO authenticated 
USING (
    EXISTS (
        SELECT 1 FROM user_profiles 
        WHERE id = auth.uid() AND role IN ('super_admin', 'admin', 'driver_lead')
    )
);

-- Insert sample products
INSERT INTO products (code, name, size, color, price, description, stock) VALUES
('PRD001', '–°“Ø“Ø 1–ª', '1–ª', '–¶–∞–≥–∞–∞–Ω', 3500, '–≠—Ä“Ø“Ø–ª –º—ç–Ω–¥–∏–π–Ω —Å“Ø“Ø', 150),
('PRD002', '–¢–∞–ª—Ö', '500–≥', '–ë–æ—Ä', 2000, '–®–∏–Ω—ç —Ç–∞–ª—Ö', 200),
('PRD003', '–¢”©–º—Å', '1–∫–≥', '–®–∞—Ä', 1500, '–®–∏–Ω—ç —Ç”©–º—Å', 300),
('PRD004', '–õ—É—É–≤–∞–Ω', '1–∫–≥', '–£–ª–∞–∞–Ω', 2500, '–®–∏–Ω—ç –ª—É—É–≤–∞–Ω', 100),
('PRD005', '–°–æ–Ω–≥–∏–Ω–æ', '1–∫–≥', '–£–ª–∞–∞–Ω', 1800, '–®–∏–Ω—ç —Å–æ–Ω–≥–∏–Ω–æ', 150),
('PRD006', '”®–Ω–¥”©–≥', '30—à', '–¶–∞–≥–∞–∞–Ω', 12000, '–®–∏–Ω—ç ”©–Ω–¥”©–≥', 80),
('PRD007', '–ì—É—Ä–∏–ª', '1–∫–≥', '–¶–∞–≥–∞–∞–Ω', 2200, '–¶–∞–≥–∞–∞–Ω –≥—É—Ä–∏–ª', 250),
('PRD008', '–ë—É–¥–∞–∞', '1–∫–≥', '–¶–∞–≥–∞–∞–Ω', 3000, '–ß–∞–Ω–∞—Ä—Ç–∞–π –±—É–¥–∞–∞', 180),
('PRD009', '–≠–ª—Å—ç–Ω —á–∏—Ö—ç—Ä', '1–∫–≥', '–¶–∞–≥–∞–∞–Ω', 2800, '–≠–ª—Å—ç–Ω —á–∏—Ö—ç—Ä', 120),
('PRD010', '–¢–æ—Å', '1–ª', '–®–∞—Ä', 8500, '–£—Ä–≥–∞–º–ª—ã–Ω —Ç–æ—Å', 90)
ON CONFLICT (code) DO NOTHING;

-- Success message
DO $$
BEGIN
    RAISE NOTICE '‚úÖ Setup completed successfully!';
    RAISE NOTICE 'Tables created: user_profiles, products, orders, driver_leads, stocks';
    RAISE NOTICE 'Sample data inserted: 10 products';
    RAISE NOTICE '';
    RAISE NOTICE 'üìù Next steps:';
    RAISE NOTICE '1. Go to Authentication > Users';
    RAISE NOTICE '2. Create demo users (see below)';
    RAISE NOTICE '3. Refresh your app (F5)';
END $$;
```

4. **RUN ‚ñ∂Ô∏è —Ç–æ–≤—á –¥–∞—Ä–∞—Ö**
5. ‚úÖ –ê–º–∂–∏–ª—Ç—Ç–∞–π “Ø–π–ª–¥—ç–ª –≥–∞—Ä–∞—Ö—ã–≥ —Ö“Ø–ª—ç—ç—Ö

---

### ‚úÖ –ê–õ–•–ê–ú 2: Demo —Ö—ç—Ä—ç–≥–ª—ç–≥—á–∏–¥ “Ø“Ø—Å–≥—ç—Ö

1. **Authentication > Users —Ä—É—É –æ—á–∏—Ö:**
   - Dashboard ‚Üí Authentication ‚Üí Users
   - "Add user" ‚Üí "Create new user" –¥–∞—Ä–∞—Ö

2. **–î–∞—Ä–∞–∞—Ö —Ö—ç—Ä—ç–≥–ª—ç–≥—á–¥–∏–π–≥ “Ø“Ø—Å–≥—ç—Ö:**

| Email | Password | Auto Confirm? |
|-------|----------|---------------|
| 99000000@logistics.mn | super123 | ‚úÖ YES |
| 99000001@logistics.mn | admin123 | ‚úÖ YES |
| 99000002@logistics.mn | operator123 | ‚úÖ YES |
| 99112233@logistics.mn | driver123 | ‚úÖ YES |
| 99112234@logistics.mn | lead123 | ‚úÖ YES |
| 99112235@logistics.mn | account123 | ‚úÖ YES |
| 99112236@logistics.mn | warehouse123 | ‚úÖ YES |

**–ß–£–•–ê–õ:** "Auto Confirm User" —Å–æ–Ω–≥–æ–ª—Ç—ã–≥ **YES** –±–æ–ª–≥–æ—Ö!

---

### ‚úÖ –ê–õ–•–ê–ú 3: User Profiles —Ö–æ–ª–±–æ—Ö

SQL Editor –¥—ç—ç—Ä **NEW QUERY** –Ω—ç—ç–∂ –¥–∞—Ä–∞–∞—Ö –∫–æ–¥—ã–≥ –∞–∂–∏–ª–ª—É—É–ª–∞—Ö:

**–ß–£–•–ê–õ:** “Æ“Ø—Å–≥—ç—Å—ç–Ω —Ö—ç—Ä—ç–≥–ª—ç–≥—á –±“Ø—Ä–∏–π–Ω **User ID (UUID)** –∞–≤–∞—Ö —Ö—ç—Ä—ç–≥—Ç—ç–π!

1. **User ID –∞–≤–∞—Ö:**
   - Authentication ‚Üí Users –¥—ç—ç—Ä
   - –•—ç—Ä—ç–≥–ª—ç–≥—á –¥—ç—ç—Ä –¥–∞—Ä–∂ –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π —Ö–∞—Ä–Ω–∞
   - UUID —Ö—É—É–ª–Ω–∞ (–∂–∏—à—ç—ç: `a1b2c3d4-e5f6-7890-abcd-ef1234567890`)

2. **SQL –∞–∂–∏–ª–ª—É—É–ª–∞—Ö:**

```sql
-- User IDs-–≥ ”©”©—Ä–∏–π–Ω “Ø“Ø—Å–≥—ç—Å—ç–Ω —Ö—ç—Ä—ç–≥–ª—ç–≥—á–¥–∏–π–Ω—Ö—ç—ç—Ä —Å–æ–ª–∏–Ω–æ —É—É!

-- Super Admin
INSERT INTO user_profiles (id, phone, name, role) VALUES
('PASTE_SUPER_ADMIN_UUID_HERE', '99000000', '–°—É–ø–µ—Ä –ê–¥–º–∏–Ω', 'super_admin');

-- Admin
INSERT INTO user_profiles (id, phone, name, role) VALUES
('PASTE_ADMIN_UUID_HERE', '99000001', '–ê–¥–º–∏–Ω –î–æ—Ä–∂', 'admin');

-- Operator
INSERT INTO user_profiles (id, phone, name, role) VALUES
('PASTE_OPERATOR_UUID_HERE', '99000002', '–û–ø–µ—Ä–∞—Ç–æ—Ä –ë–æ–ª–¥', 'operator');

-- Driver
INSERT INTO user_profiles (id, phone, name, role, driver_name) VALUES
('PASTE_DRIVER_UUID_HERE', '99112233', '–ñ–æ–ª–æ–æ—á –ë–∞—Ç', 'driver', '–ë–∞—Ç');

-- Driver Lead
INSERT INTO user_profiles (id, phone, name, role) VALUES
('PASTE_LEAD_UUID_HERE', '99112234', '–ê—Ö–ª–∞–≥—á –¶—ç—Ä—ç–Ω', 'driver_lead');

-- Accounting
INSERT INTO user_profiles (id, phone, name, role) VALUES
('PASTE_ACCOUNTING_UUID_HERE', '99112235', '–ù—è–≥—Ç–ª–∞–Ω –°–∞—Ä–∞', 'accounting');

-- Warehouse
INSERT INTO user_profiles (id, phone, name, role) VALUES
('PASTE_WAREHOUSE_UUID_HERE', '99112236', '–ê–≥—É—É–ª–∞—Ö –ì–∞–Ω–±–∞—Ç', 'warehouse');
```

3. **RUN –¥–∞—Ä–∞—Ö**

---

### ‚úÖ –ê–õ–•–ê–ú 4: –ê–ø–ø refresh —Ö–∏–π—Ö

1. Browser –¥—ç—ç—Ä **F5** –¥–∞—Ä–Ω–∞
2. –ù—ç–≤—Ç—Ä—ç—Ö —Ö—É—É–¥–∞—Å –¥–∞—Ö–∏–Ω —Ö–∞—Ä–∞–≥–¥–∞–Ω–∞
3. **99000000** / **super123** –æ—Ä—É—É–ª–∂ –Ω—ç–≤—Ç—Ä—ç—Ö
4. **–ê–º–∂–∏–ª—Ç—Ç–∞–π!** üéâ

---

## üÜò –ê—Å—É—É–¥–∞–ª “Ø—Ä–≥—ç–ª–∂–∏–ª–∂ –±–∞–π–≤–∞–ª:

### Console (F12) —à–∞–ª–≥–∞—Ö:

1. Browser –¥—ç—ç—Ä **F12** –¥–∞—Ä–Ω–∞
2. **Console** tab —Å–æ–Ω–≥–æ–Ω–æ
3. –£–ª–∞–∞–Ω –∞–ª–¥–∞–∞–Ω—É—É–¥—ã–≥ —É–Ω—à–∏–Ω–∞
4. –¢—É—Å —Ñ–∞–π–ª–¥ –±—É—Ü–∞–∂ –∏—Ä–∂ —Ç–æ—Ö–∏—Ä–æ—Ö —à–∏–π–¥–ª–∏–π–≥ –æ–ª–Ω–æ

### –¢“Ø–≥—ç—ç–º—ç–ª –∞–ª–¥–∞–∞–Ω—É—É–¥:

#### ‚ùå "Invalid login credentials"
‚Üí Demo —Ö—ç—Ä—ç–≥–ª—ç–≥—á–∏–¥ “Ø“Ø—Å–≥—ç—ç–≥“Ø–π —ç—Å–≤—ç–ª Auto Confirm —Ö–∏–π–≥—ç—ç–≥“Ø–π

#### ‚ùå "relation 'user_profiles' does not exist"
‚Üí –ê–õ–•–ê–ú 1 –¥–∞—Ö—å SQL –∫–æ–¥ –∞–∂–∏–ª–ª—É—É–ª–∞–∞–≥“Ø–π

#### ‚ùå "Failed to fetch"
‚Üí `.env` —Ñ–∞–π–ª –±–∞–π—Ö–≥“Ø–π —ç—Å–≤—ç–ª –±—É—Ä—É—É

---

## üìû –¢—É—Å–ª–∞–º–∂:

–≠–Ω—ç –∞–ª—Ö–º—É—É–¥—ã–≥ –¥–∞–≥–∞–∂ —Ö–∏–π—Å—ç–Ω –±–æ–ª–æ–≤—á –∞–∂–∏–ª–ª–∞—Ö–≥“Ø–π –±–∞–π–≤–∞–ª:

1. **Console** (F12) –¥—ç—ç—Ä—Ö –∞–ª–¥–∞–∞–Ω—ã screenshot –∞–≤–Ω–∞
2. Supabase Dashboard –¥—ç—ç—Ä—Ö Table Editor —Ö–∞—Ä–Ω–∞ (Tables “Ø“Ø—Å—Å—ç–Ω —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö)
3. `.env` —Ñ–∞–π–ª –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö

---

**–û–î–û–û –≠–î–ì–≠–≠–† –ê–õ–•–ú–´–ì –î–ê–ì–ê–ñ –•–ò–ô–ù–≠ “Æ“Æ! 5-10 –º–∏–Ω—É—Ç —Ö–∞–Ω–≥–∞–ª—Ç—Ç–∞–π.**